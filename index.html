<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的媒体收藏馆</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🎬</text></svg>">
    <style>
        :root {
            --gap: 10px;
            --bg: #f0f0f0;
            --border: #ddd;
            --card-bg: #ffffff;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg);
            color: #333;
        }

        /* 布局网格 */
        #mediaGrid {
            display: flex;
            flex-wrap: wrap;
            padding: 20px;
            gap: var(--gap);
            box-sizing: border-box;
            max-width: 1600px;
            margin: 0 auto;
        }

        /* 卡片样式 */
        .media-item {
            width: calc(25% - var(--gap)); /* 默认四列 */
            border: 1px solid var(--border);
            background: var(--card-bg);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
            border-radius: 8px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-sizing: border-box;
            aspect-ratio: 16/9; /* 强制统一比例，更加整齐 */
        }

        .media-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            z-index: 10;
        }

        /* 媒体内容 */
        .media-item video,
        .media-item img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* 保持填充 */
            display: block;
            cursor: pointer;
        }

        /* 响应式布局 */
        @media (max-width: 1024px) {
            .media-item { width: calc(33.333% - var(--gap)); } /* 平板三列 */
        }

        @media (max-width: 768px) {
            .media-item { width: calc(50% - var(--gap)); } /* 手机两列 */
        }

        @media (max-width: 480px) {
            .media-item { width: 100%; } /* 小屏单列 */
        }

        /* 全屏覆盖层 */
        #fullscreenContainer {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            cursor: pointer;
            backdrop-filter: blur(5px);
        }

        #fullscreenImage {
            max-width: 95%;
            max-height: 95%;
            object-fit: contain;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            pointer-events: none;
        }

        /* 加载状态与缩略图 */
        .media-item .thumbnail {
            filter: blur(8px);
            transform: scale(1.1);
            transition: filter 0.5s, transform 0.5s;
        }

        .media-item .thumbnail.loaded {
            filter: blur(0);
            transform: scale(1);
        }

        /* 分页控件 */
        #pagination {
            display: flex;
            justify-content: center;
            padding: 30px 10px;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        button {
            background-color: #fff;
            border: 1px solid var(--border);
            color: #333;
            padding: 8px 16px;
            cursor: pointer;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s;
        }

        button:hover:not(:disabled) {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background-color: #f9f9f9;
        }

        #pageInput {
            width: 50px;
            padding: 5px;
            text-align: center;
            border: 1px solid var(--border);
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <main id="mediaGrid"></main>

    <div id="pagination">
        <button id="prevPageBtn" disabled>上一页</button>
        <span id="pageInfo">第 <span id="currentPage">1</span> 页 / 共 <span id="totalPages">1</span> 页</span>
        <button id="nextPageBtn" disabled>下一页</button>
        <span style="display: flex; align-items: center; gap: 5px;">
            跳转到
            <input type="number" id="pageInput" min="1">
            页
            <button id="goToPageBtn">Go</button>
        </span>
    </div>

    <div id="fullscreenContainer" role="dialog" aria-modal="true" tabindex="-1">
        <img id="fullscreenImage" src="" alt="Fullscreen Image">
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // ==========================================
            // 1. 数据配置区 (在这里修改你的视频和图片链接)
            // ==========================================
            const mediaData = [
                // 示例：视频格式 (推荐使用 mp4)
                {
                    type: 'video',
                    url: 'https://files.catbox.moe/6figov.mp4', 
                    poster: 'https://files.catbox.moe/lq7ut6.jpg', // 视频未播放时显示的封面
                    thumbnail: 'https://files.catbox.moe/lq7ut6.jpg' // 列表页显示的缩略图
                },
                // 示例：图片格式
                {
                    type: 'image',
                    url: 'https://files.catbox.moe/in5uez.jpg',
                    thumbnail: 'https://files.catbox.moe/in5uez.jpg'
                },
                // --- 以下是复制的示例数据，你需要替换为你自己的图床直链 ---
                {
                    url: 'https://files.catbox.moe/fz57ex.mp4',
                    type: 'video',
                    poster: 'https://files.catbox.moe/8wkazh.jpg',
                    thumbnail: 'https://files.catbox.moe/8wkazh.jpg'
                },
                {
                    url: 'https://files.catbox.moe/loausl.mp4',
                    type: 'video',
                    poster: 'https://files.catbox.moe/c7v5ko.jpg',
                    thumbnail: 'https://files.catbox.moe/c7v5ko.jpg'
                },
                {
                    url: 'https://files.catbox.moe/l6aa5o.jpg',
                    type: 'image',
                    thumbnail: 'https://files.catbox.moe/l6aa5o.jpg'
                },
                {
                    url: 'https://files.catbox.moe/qkkx6i.mp4',
                    type: 'video',
                    poster: 'https://files.catbox.moe/06l4k7.jpg',
                    thumbnail: 'https://files.catbox.moe/06l4k7.jpg'
                },
                {
                    url: 'https://files.catbox.moe/w23som.mp4',
                    type: 'video',
                    poster: 'https://files.catbox.moe/4mcv1u.jpg',
                    thumbnail: 'https://files.catbox.moe/4mcv1u.jpg'
                },
                {
                    url: 'https://files.catbox.moe/ri58v2.mp4',
                    type: 'video',
                    poster: 'https://files.catbox.moe/8sbfgc.jpg',
                    thumbnail: 'https://files.catbox.moe/8sbfgc.jpg'
                },
                {
                    url: 'https://files.catbox.moe/60753g.mp4',
                    type: 'video',
                    poster: 'https://files.catbox.moe/epdboz.jpg',
                    thumbnail: 'https://files.catbox.moe/epdboz.jpg'
                },
                {
                    url: 'https://files.catbox.moe/ncsdko.mp4',
                    type: 'video',
                    poster: 'https://files.catbox.moe/a3ixgf.jpg',
                    thumbnail: 'https://files.catbox.moe/a3ixgf.jpg'
                },
                {
                    url: 'https://files.catbox.moe/kbjqs9.mp4',
                    type: 'video',
                    poster: 'https://files.catbox.moe/48h9nu.jpg',
                    thumbnail: 'https://files.catbox.moe/48h9nu.jpg'
                },
                {
                    url: 'https://files.catbox.moe/akkudt.mp4',
                    type: 'video',
                    poster: 'https://files.catbox.moe/o0q67v.jpg',
                    thumbnail: 'https://files.catbox.moe/o0q67v.jpg'
                },
                {
                    url: 'https://files.catbox.moe/5y4h9h.mp4',
                    type: 'video',
                    poster: 'https://files.catbox.moe/t5xj2e.jpg',
                    thumbnail: 'https://files.catbox.moe/t5xj2e.jpg'
                },
                {
                    url: 'https://files.catbox.moe/lrkgvk.mp4',
                    type: 'video',
                    poster: 'https://files.catbox.moe/uo7r2u.jpg',
                    thumbnail: 'https://files.catbox.moe/uo7r2u.jpg'
                },
                {
                    url: 'https://files.catbox.moe/khicll.mp4',
                    type: 'video',
                    poster: 'https://files.catbox.moe/ziedot.jpg',
                    thumbnail: 'https://files.catbox.moe/ziedot.jpg'
                },
                {
                    url: 'https://files.catbox.moe/7mtszp.mp4',
                    type: 'video',
                    poster: 'https://files.catbox.moe/k6mt97.jpg',
                    thumbnail: 'https://files.catbox.moe/k6mt97.jpg'
                }
            ];

            // ==========================================
            // 2. 核心逻辑 (建议保持不变)
            // ==========================================
            const grid = document.getElementById('mediaGrid');
            const fullscreenContainer = document.getElementById('fullscreenContainer');
            const fullscreenImage = document.getElementById('fullscreenImage');
            const prevPageBtn = document.getElementById('prevPageBtn');
            const nextPageBtn = document.getElementById('nextPageBtn');
            const goToPageBtn = document.getElementById('goToPageBtn');
            const pageInput = document.getElementById('pageInput');
            const currentPageSpan = document.getElementById('currentPage');
            const totalPagesSpan = document.getElementById('totalPages');
            
            const allVideos = [];
            const blobUrls = []; // 用于存储生成的 Blob URL，以便页面关闭时清理
            let currentVideoBlobUrl = null;

            // 分页设置
            const itemsPerPage = 16;
            let currentPage = 1;
            let totalPages = Math.ceil(mediaData.length / itemsPerPage);

            // 工具：将URL转换为Blob (处理CORS问题)
            async function urlToBlob(url) {
                const resp = await fetch(url);
                if (!resp.ok) throw new Error(`HTTP ${resp.status} ${url}`);
                return await resp.blob();
            }

            // 停止其他视频播放
            function stopAllExcept(current) {
                allVideos.forEach(v => {
                    if (v !== current) v.pause();
                });
            }

            // 显示全屏图片
            function showImage(src, alt = '') {
                fullscreenImage.src = src;
                fullscreenImage.alt = alt;
                fullscreenContainer.style.display = 'flex';
                fullscreenImage.focus();
            }

            function hideImage() {
                fullscreenContainer.style.display = 'none';
                fullscreenImage.src = '';
            }

            // 键盘控制视频
            function bindKeyboardForVideo(video) {
                video.addEventListener('keydown', e => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        video.paused ? video.play() : video.pause();
                    }
                    if (e.key === 'f') {
                        e.preventDefault();
                        document.fullscreenElement ? document.exitFullscreen() : video.requestFullscreen();
                    }
                });
            }

            // 懒加载观察器
            const observer = new IntersectionObserver((entries, obs) => {
                entries.forEach(entry => {
                    if (!entry.isIntersecting) return;
                    const wrapper = entry.target;
                    const { type, url, poster, alt, thumbnail } = wrapper.dataset;

                    if (type === 'video') {
                        loadVideo(wrapper, url, poster || '', thumbnail || '');
                    } else {
                        loadImage(wrapper, url, alt || '', thumbnail || '');
                    }
                    obs.unobserve(wrapper);
                });
            }, { rootMargin: '200px' });

            // 渲染页面
            function renderPage(page) {
                grid.innerHTML = '';
                allVideos.length = 0; 
                
                const startIndex = (page - 1) * itemsPerPage;
                const endIndex = Math.min(startIndex + itemsPerPage, mediaData.length);

                for (let i = startIndex; i < endIndex; i++) {
                    const item = mediaData[i];
                    const wrapper = document.createElement('div');
                    wrapper.className = 'media-item';
                    wrapper.dataset.type = item.type;
                    wrapper.dataset.url = item.url;
                    if (item.poster) wrapper.dataset.poster = item.poster;
                    if (item.thumbnail) wrapper.dataset.thumbnail = item.thumbnail;
                    
                    // 先显示缩略图，等待懒加载触发
                    const thumbnailImg = document.createElement('img');
                    thumbnailImg.className = 'thumbnail';
                    thumbnailImg.src = item.thumbnail || item.poster || 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7'; // 占位图
                    thumbnailImg.alt = 'Loading...';
                    
                    thumbnailImg.onload = () => thumbnailImg.classList.add('loaded');
                    
                    wrapper.appendChild(thumbnailImg);
                    grid.appendChild(wrapper);
                    observer.observe(wrapper);
                }

                updatePaginationButtons();
                updatePageInfo();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            function updatePaginationButtons() {
                prevPageBtn.disabled = currentPage === 1;
                nextPageBtn.disabled = currentPage === totalPages;
            }

            function updatePageInfo() {
                currentPageSpan.textContent = currentPage;
                totalPagesSpan.textContent = totalPages;
            }

            // 加载视频逻辑
            async function loadVideo(container, url, poster, thumbnail) {
                const video = document.createElement('video');
                video.controls = false; 
                video.poster = poster;
                video.preload = 'metadata';
                video.volume = 0.5;
                video.tabIndex = 0;

                // 简单的点击播放/暂停，双击全屏
                let clickTimer = null;
                video.addEventListener('click', () => {
                    if (clickTimer) clearTimeout(clickTimer);
                    clickTimer = setTimeout(() => {
                        video.paused ? video.play() : video.pause();
                        clickTimer = null;
                    }, 250);
                });

                video.addEventListener('dblclick', () => {
                    if (clickTimer) { clearTimeout(clickTimer); clickTimer = null; }
                    document.fullscreenElement ? document.exitFullscreen() : video.requestFullscreen();
                });

                video.addEventListener('fullscreenchange', () => {
                    video.controls = !!document.fullscreenElement;
                });

                video.addEventListener('play', () => stopAllExcept(video));
                video.addEventListener('ended', () => {
                    video.currentTime = 0;
                    video.play(); 
                });

                bindKeyboardForVideo(video);

                // 尝试 Blob 加载，失败则回退到直接链接
                try {
                    const blob = await urlToBlob(url);
                    const blobUrl = URL.createObjectURL(blob);
                    video.src = blobUrl;
                    blobUrls.push(blobUrl);
                    // 标记加载完成
                    const thumb = container.querySelector('.thumbnail');
                    if(thumb) thumb.classList.add('loaded');
                } catch (e) {
                    // console.warn('Blob fetch failed (likely CORS), fallback to direct URL:', url);
                    video.src = url;
                }
                
                container.innerHTML = '';
                container.appendChild(video);
                allVideos.push(video);
            }

            // 加载图片逻辑
            async function loadImage(container, url, alt = '', thumbnail) {
                const img = document.createElement('img');
                img.alt = alt;
                img.tabIndex = 0;

                img.addEventListener('dblclick', (e) => {
                    e.preventDefault();
                    showImage(img.src, img.alt);
                });

                img.addEventListener('keydown', e => {
                    if (e.key === 'Enter') showImage(img.src, img.alt);
                });

                try {
                    const blob = await urlToBlob(url);
                    const blobUrl = URL.createObjectURL(blob);
                    img.src = blobUrl;
                    blobUrls.push(blobUrl);
                } catch (e) {
                    img.src = url;
                }
                
                container.innerHTML = '';
                container.appendChild(img);
            }

            // 事件监听
            fullscreenContainer.addEventListener('click', hideImage);
            window.addEventListener('beforeunload', () => {
                blobUrls.forEach(url => URL.revokeObjectURL(url));
            });

            prevPageBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderPage(currentPage);
                }
            });

            nextPageBtn.addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    renderPage(currentPage);
                }
            });

            goToPageBtn.addEventListener('click', () => {
                const page = parseInt(pageInput.value, 10);
                if (!isNaN(page) && page >= 1 && page <= totalPages) {
                    currentPage = page;
                    renderPage(currentPage);
                } else {
                    alert(`请输入有效的页码 (1-${totalPages})`);
                    pageInput.value = '';
                }
            });

            // 初始化
            renderPage(1);
        });
    </script>
</body>
</html>